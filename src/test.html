<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interact with Ethereum Contract</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.3/dist/web3.min.js"></script>
</head>
<body>

<h1>Interact with Ethereum Contract</h1>

<button onclick="createProject()">Create Project</button>
<button onclick="getAllProjects()">Get All Projects</button>

<script>
  // Set up web3.js with the provider
    if (typeof window.ethereum !== 'undefined') {
        window.web3 = new Web3(window.ethereum);
        window.ethereum.enable();
    } else {
        alert('Please install MetaMask to interact with this page.');
    }

    // Contract ABI (replace with your actual ABI)
    const contractABI = [
        {
            "inputs": [
                {
                    "internalType": "string",
                    "name": "_ownerName",
                    "type": "string"
                },
                {
                    "internalType": "string",
                    "name": "_projectName",
                    "type": "string"
                },
                {
                    "internalType": "string",
                    "name": "_description",
                    "type": "string"
                },
                {
                    "internalType": "string",
                    "name": "_imageUrl",
                    "type": "string"
                },
                {
                    "internalType": "uint256",
                    "name": "_goalAmount",
                    "type": "uint256"
                }
            ],
            "name": "createProject",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "projectId",
                    "type": "uint256"
                },
                {
                    "indexed": false,
                    "internalType": "address",
                    "name": "funder",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "amount",
                    "type": "uint256"
                }
            ],
            "name": "FundingReceived",
            "type": "event"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "projectId",
                    "type": "uint256"
                },
                {
                    "internalType": "uint256",
                    "name": "amount",
                    "type": "uint256"
                }
            ],
            "name": "fundProject",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "projectId",
                    "type": "uint256"
                }
            ],
            "name": "ProjectClosed",
            "type": "event"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "projectId",
                    "type": "uint256"
                },
                {
                    "indexed": false,
                    "internalType": "address",
                    "name": "ownerAddress",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "string",
                    "name": "projectName",
                    "type": "string"
                },
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "goalAmount",
                    "type": "uint256"
                }
            ],
            "name": "ProjectCreated",
            "type": "event"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "projectId",
                    "type": "uint256"
                },
                {
                    "indexed": false,
                    "internalType": "address",
                    "name": "remover",
                    "type": "address"
                }
            ],
            "name": "ProjectRemoved",
            "type": "event"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "projectId",
                    "type": "uint256"
                },
                {
                    "indexed": false,
                    "internalType": "string",
                    "name": "newDescription",
                    "type": "string"
                }
            ],
            "name": "ProjectUpdated",
            "type": "event"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "projectId",
                    "type": "uint256"
                }
            ],
            "name": "removeProject",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "projectId",
                    "type": "uint256"
                },
                {
                    "internalType": "string",
                    "name": "_newDescription",
                    "type": "string"
                }
            ],
            "name": "updateProjectDescription",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "getAllProjects",
            "outputs": [
                {
                    "components": [
                        {
                            "internalType": "address",
                            "name": "ownerAddress",
                            "type": "address"
                        },
                        {
                            "internalType": "string",
                            "name": "ownerName",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "projectName",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "description",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "imageUrl",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "goalAmount",
                            "type": "uint256"
                        },
                        {
                            "internalType": "uint256",
                            "name": "fundedAmount",
                            "type": "uint256"
                        },
                        {
                            "internalType": "bool",
                            "name": "isOpen",
                            "type": "bool"
                        }
                    ],
                    "internalType": "struct dFUSE.Project[]",
                    "name": "",
                    "type": "tuple[]"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "projectCounter",
            "outputs": [
                {
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        }
    ];

    // Contract address (replace with your actual contract address)
    const contractAddress = '0x9Fd4cC68996C39a54bEf014FE2238F2bc12e45DC';

    // Create a contract instance
    const contract = new web3.eth.Contract(contractABI, contractAddress);

    // Function to create a project
    async function createProject() {
        const ownerName = 'Dark';
        const projectName = 'dFuse';
        const description = 'Kickstarter alternative';
        const imageUrl = 'https://static.vecteezy.com/system/resources/thumbnails/022/865/183/small/ai-generative-technology-block-chain-concept-background-photo.jpg';
        const goalAmount = web3.utils.toWei('100', 'ether');

        try {
        const accounts = await web3.eth.getAccounts();
        await contract.methods.createProject(ownerName, projectName, description, imageUrl, goalAmount).send({ from: accounts[0] });
        alert('Project created successfully!');
        } catch (error) {
        alert('Failed to create project: ' + error.message);
        }
    }

    // Function to get all projects
    async function getAllProjects() {
        try {
        const projects = await contract.methods.getAllProjects().call();
        console.log('All Projects:', projects);
        // Display projects on the HTML page as desired
        } catch (error) {
        alert('Failed to get all projects: ' + error.message);
        }
    }
</script>

</body>
</html>
